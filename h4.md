# Control Daemons with Salt (summary) - X
> Reference: <https://terokarvinen.com/2018/04/03/pkg-file-service-control-daemons-with-salt-change-ssh-server-port/?fromSearch=karvinen%20salt%20ssh>

#### Create required states for daemons
- Easily control a huge number of daemons with a configuration management system.
- Package -> file -> service is the common pattern.
- **Install software, replace config file, restart daemon**

#### Steps (with salt):
- Create the .sls file. 
- Include in the file:
  - `pkg.installed` - the daemon we want
  - `file.managed` - the configurations we're applying on the daemon
  - `service.running` - make sure daemon is up and running
    - **bonus** - include `- watch: ` with the `service.running` so that salt will restart the service everytime there is a configuration change!
    - This is all about automation after all...
- Once everything is configured in the .sls file on the master. `/srv/salt/<module>/init.sls`. (`<module>` point to the daemon we're configuring, for example SSH, Apache2, UFW etc...)
- We can go ahead use Salt to apply the state our slaves with `$ sudo salt '*' state.apply <module>`. Simple as that! üôè 
- If you configured the `- watch: ` parameter in you state file with the `service.running`, then every time you make a change to the config file, it should automatically be applied to all your slave without manual intervention.
- I say "should", because we all know computers don't always compute the way we would like them to compute.
  - **Always make sure and never trust blindly!**


# Apache - A
I created an infrastructure where I could try out doing my configurations locally on a salt-minion, and then over the network from my salt-master using automation. 
- Accepting the keys on my master and then doing a quick connection test
  - ![Screenshot 2025-04-21 at 15 12 51](https://github.com/user-attachments/assets/89b85514-c2ca-4a18-80b7-655ea7d6b27b)

### Manual Minion01 
- Apache was not yet present on the system.
  - ![Screenshot 2025-04-21 at 15 18 00](https://github.com/user-attachments/assets/a6eb7553-9778-48c5-aaf9-a3ff3dd6234c)
- Changed this manually with first running `$ sudo apt update && sudo apt upgrade -y` and then installing the apache with `$ sudo apt install apache2`
- Once apache was installed, I located the index.html file which is stored under the `/var/www/html/` directory path and edited the default site.
  - ![Screenshot 2025-04-21 at 15 37 16](https://github.com/user-attachments/assets/b2c93bb2-1865-4eb0-bc2d-3ff832cae6e6)
- Once the changes were made, I saved the file and typed my minions IP-address in my browser to see the changes.
  - <img width="1427" alt="Screenshot 2025-04-21 at 15 37 59" src="https://github.com/user-attachments/assets/8f3180fa-f21f-4c2e-ae66-88e2f5584bf6" />

### Automated Minion02 
- Making sure the minion02 doesn't have apache installed already
  - ![Screenshot 2025-04-21 at 15 55 01](https://github.com/user-attachments/assets/b3873bfe-92ab-4581-b563-f6519b937a66)
- After I had made sure that minion02 was fresh and clean. I logged into my salt-master, created the `/srv/salt` + the apache module + moved into it + created the state file with the command
  - `$ sudo mkdir -p /srv/salt/apache && cd /srv/salt/apache && sudo touch init.sls`
  - ![Screenshot 2025-04-21 at 16 14 16](https://github.com/user-attachments/assets/9bb83e96-83cc-40c0-8f91-922900c1e9be)




