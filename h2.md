# Summary - X
> <https://terokarvinen.com/palvelinten-hallinta/>


## Virtual networking - X 
> Reference: <https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/>

A quick guide to setup a two computer virtual network in minutes
- Install vagrant with: `$ sudo apt update && sudo apt install vagrant virtualbox`
- Saving your **vagrantfile** in a new directory: `$ mkdir thedirectory` and then inside the directory `$ nano Vagrantfile`
- Template for the config file can be found @ the link above.
- After you have the machines up and running, you can log in to them via SSH: `$ vagrant ssh <name>`
- **Perks:** very easy to destroy `$ vagrant destroy` & super simple to get machines up and running again `$ vagrant up`


## The master & the slave - X
See <https://ali-mikael.github.io/pal/h1> - "The master and the slave" for summary!


## Salt Vagrant - X
> Reference:
> - <https://terokarvinen.com/2023/salt-vagrant/#infra-as-code---your-wishes-as-a-text-file>
> - <https://docs.saltproject.io/salt/user-guide/en/latest/topics/states.html#organizing-states>
> - <https://medium.com/@mickeyschwarz789/the-basics-of-salt-822a12909892>

**An example of applying a state:**
- Create the desired path: `$ sudo mkdir -p /srv/salt/hello`.
- `/srv/salt` is the default root where salt looks for state files. In this case "hello" is the new state we're going to configure.
- Create the Salt State File A.K.A **.sls**: `$ sudoedit /srv/salt/hello/init.sls`.
- The .sls like all file extensions in Linux is only for the end user to differentiate more easily between files. 
- Contents of the `init.sls` file (written YAML):
- ```
  $ /tmp/infra-as-code:
      file.managed
  ```
- Now you can apply this to all minions simply with: `$ sudo salt '*' state.apply hello`.
- **Q: But what does it do?**
  - A: You basically apply the `hello` state (which you created and configured yourself), on all minions (by using the wild card = *), to check if they have the file `/tmp/infra-as-code`, and in case it isn't present, well you know, create it (an empty file named infra-as-code)!
<br>

**top.sls**
- The top.sls helps with scaling, as you can easily specify which states to run on which minions, without having to manually type everything out on the commandline.
- `/srv/salt/top.sls`
- contents of our top.sls in this example:
- ```
  base:
    '*':
      -hello
  ````
- `base` is the default environment to use as the root.
- `'*'` means all the minions. Here you could specify which minions in particular with the minion ID.
- `-hello` tells salt to apply the hello state.  
- Now you don't have to specify which modules to run. You simply type `$ sudo salt '*' state.apply`, and it will automatically run the hello state (in this case) on all your minions at the same time.

<br>
<br>




# Vagrant - A / B
> Reference:
> <https://developer.hashicorp.com/vagrant/install>
> <https://docs.brew.sh/Taps#the-brew-tap-command>
> <https://terokarvinen.com/palvelinten-hallinta/>
> <https://vagrantcloud.com/search>
> <https://developer.hashicorp.com/vagrant/docs/boxes>


**Setting up**
- I already had VirtualBox installed and in use on my computer, so I only needed to install Vagrant.
- I used commands
- `$ brew tap hashicorp/tap` (this adds the repo to known repositories for brew to install and update from) (brew is a package manager for MacOS)
  - <img width="551" alt="Screenshot 2025-04-07 at 12 33 15" src="https://github.com/user-attachments/assets/fbf62a6c-8a35-4786-a044-60e93de76bb1" />
- `$ brew install hashicorp/tap/hashicorp-vagrant` (this installs vagrant)
  - <img width="1133" alt="Screenshot 2025-04-07 at 12 36 57" src="https://github.com/user-attachments/assets/30d5015f-3ec5-4def-b380-25ad74570917" />
- `$ vagrant init` is the command to produce a Vagrantfile which will work as the basic configuration file for your VM/VM's.
  - <img width="854" alt="Screenshot 2025-04-07 at 12 38 12" src="https://github.com/user-attachments/assets/22a4ba95-edfc-4da0-93cc-f1887c2585d2" />
- I then searched for compatible base images A.K.A boxes to use for the VM in the vagrant cloud @ <https://vagrantcloud.com/search>
- Specified parameters **"Provider: Virtualbox"** & **"Architecture: arm64"** to cater to my needs.
  - ![Screenshot 2025-04-07 at 20 28 26](https://github.com/user-attachments/assets/ab99f014-703b-4124-b66f-48776b0d5010)
- I scrolled down the page until I found a `bento/` box for Ubuntu which I thought would suit me just fine.
- <https://portal.cloud.hashicorp.com/vagrant/discover/bento/ubuntu-24.04>
- **Q:** Why bento you might ask? **A:** Because Vagrant officially recommended them on their website. Read: <https://developer.hashicorp.com/vagrant/docs/boxes> for more!
- **Q:** Okay but why Ubuntu? **A:** Just a question of preference honestly. I have some experience with Ubuntu and it feels nice so why not innit. ðŸ˜‚
- After I located a proper box, I went ahead and added it on Vagrant with the command `$ vagrant box add bento/ubuntu-24.04`.
- Vagrant then asked me whitch provider to use, so I obviously chose VirtalBox!
- And then with the command `$ vagrant box list` I made sure of two things:
  - 1) It was added properly.
  - 2) It was the image with the correct architecture. (arm64 in my case)
  - <img width="1303" alt="Screenshot 2025-04-07 at 21 39 40" src="https://github.com/user-attachments/assets/88e7587c-4b7d-4534-a93d-66f0b57e9576" />
- Now I could add them to the Vagrant config file:
  - <img width="1304" alt="Screenshot 2025-04-07 at 22 15 48" src="https://github.com/user-attachments/assets/81cb42fa-3f98-46d8-8a48-b0239bcf8c29" />
- `$ vagrant ssh` will connect to your new VM!
  - <img width="1224" alt="Screenshot 2025-04-07 at 21 45 04" src="https://github.com/user-attachments/assets/6ec37e10-1f1c-4919-8217-df52fa01f2c9" />
  - <img width="1059" alt="Screenshot 2025-04-07 at 21 46 11" src="https://github.com/user-attachments/assets/e8505419-0ca8-420a-b121-37bdf41026ef" />
- Everything worked fine, so this test run was conlcuded as a success!
- Terminating Playgroundprotocol
  - <img width="1025" alt="Screenshot 2025-04-07 at 21 46 48" src="https://github.com/user-attachments/assets/00258de8-c5b9-4594-9600-9e94de0261a9" />



<br>
<br>

# Two to make it True! - C / D
> References:
> <https://developer.hashicorp.com/vagrant/docs/provisioning/shell>
> <https://terokarvinen.com/2018/automatically-provision-vagrant-virtualmachines-as-salt-slaves/>
> <https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/>
> <https://terokarvinen.com/2023/salt-vagrant/#infra-as-code---your-wishes-as-a-text-file>


So I decided to kill two birds with one stone. 
- The script
  - <img width="1366" alt="Screenshot 2025-04-08 at 2 50 36" src="https://github.com/user-attachments/assets/60e4db76-3b80-498d-8028-16cbd5fd375b" />
  - <img width="1366" alt="Screenshot 2025-04-08 at 2 51 06" src="https://github.com/user-attachments/assets/364326fe-325f-4485-8b31-aff401708580" />
- yee







## Sources/References
- <https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/>
- <https://ali-mikael.github.io/pal/h1>
- <https://terokarvinen.com/2023/salt-vagrant/#infra-as-code---your-wishes-as-a-text-file>
- <https://docs.saltproject.io/salt/user-guide/en/latest/topics/states.html#organizing-states>
- <https://docs.saltproject.io/en/3006/ref/states/all/salt.states.file.html>
- <https://medium.com/@mickeyschwarz789/the-basics-of-salt-822a12909892>
- <https://developer.hashicorp.com/vagrant/install>
- <https://docs.brew.sh/Taps#the-brew-tap-command>
- <https://developer.hashicorp.com/vagrant/docs/boxes>

 
