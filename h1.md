# Salt lake City (X)
<br>

## Running salt command locally
> Reference: <https://terokarvinen.com/2021/salt-run-command-locally/>

**Salt functions**
- Salt is normally used to control slave-computers over a network.
- It can be downloaded using: `$ sudo apt update && sudo apt install salt-minion -y` (installing the salt slave)
- The five most important state functions:
  - **PKG**
    - Installed application x - `pkg.installed`
  - **File**
    - All Linux configurations are text files - `file.managed`
  - **Service**
    - Automatically restarting the daemon when needed - `service.running`
  - **User**
    - Is there a user? - `user.present`
  - **CMD**
    - Running commands - `cmd.run`
<br>



## Installing salt
> Reference: <https://docs.saltproject.io/salt/install-guide/en/latest/topics/install-by-operating-system/linux-deb.html>

**How to install salt for Debian**
- Installing the Salt Project repository:
  - `$ mkdir -p /etc/apt/keyrings` (making sure the keyrings dir exists)
  - `$ curl -fsSL https://packages.broadcom.com/artifactory/api/security/keypair/SaltProjectKey/public | sudo tee /etc/apt/keyrings/salt-archive-keyring.pgp` (downloading public key)
  - `$ curl -fsSL https://github.com/saltstack/salt-install-guide/releases/latest/download/salt.sources | sudo tee /etc/apt/sources.list.d/salt.sources` (creating apt repository target configuration)
- `$ sudo apt update` to update the metadata
- Now you can install minion, master or other Salt components!
- When the wanted components are installed, go ahead and activate them with: `$ sudo systemctl enable xx && sudo systemctl start xx`
<br>


## The master and the slave
> Reference: <https://terokarvinen.com/2018/03/28/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/> 

We already know that Salt can be used to control slave-computers over a network. 
Now, we're gonna briefly look into the installation process. 
<br>

**Installing the master**
- `$ sudo apt update && sudo apt install salt-master -y`
- get the masters hostname with: `$ hostname -I`
<br>

**Making the slaves obedient**
- On the slave, edit the minion (slave) file `$ /etc/salt/minion`
- Type in the master hostname and ID for the slave (ID must be unique).
- To be able to connect to the master restart the slave daemon: `$ sudo systemctl restart salt-minion.service`
- Then back on the master, accept the slave key: `$ sudo salt-key -A`
- Now you can make the slave follow commands. Try it out first with: `$ sudo salt '*' cmd.run 'whoami'`.
  - Did you get a reply?
  -  if answer = yes: print("it's working")
  -  else: print("try again")




## How to write a technical report 101 
> Reference: <https://terokarvinen.com/2006/06/04/raportin-kirjoittaminen-4/>

**Things to keep in mind**
- Write down everything you do in detail!
  - How you did it.
  - What kind of environment you did it in.
  - And everything that happened as a consequence.
  - Best practise is to write down as you go!
- Always remember to be spesific and thorough when reporting problems & unexpected outcomes/behavior.
- How did you fix them, or were you able to fixe them at all? Do tell!
- Format the report properly so that it is easy to read and follow along.
- Always remember to include your references and sources!



# Salt-minion (B)
> References: <https://docs.saltproject.io/salt/install-guide/en/latest/topics/install-by-operating-system/linux-deb.html>

- I had a Linux machine running with Debian12 on my laptop, so I started the process by first downloading the Salt-project public key with the command seen in the picture:
  - <img width="1111" alt="Screenshot 2025-03-31 at 23 54 03" src="https://github.com/user-attachments/assets/b31fe9d9-2679-436f-b695-f802077030ee" />
  
- I then made sure that it exists:
  - <img width="568" alt="Screenshot 2025-03-31 at 23 56 31" src="https://github.com/user-attachments/assets/2ca98b8c-45e9-4829-9c9f-53d4efe25ff5" />
  - There was a typo in the name, so I used `sudo mv salt-arhive-keyring.pgp salt-archive.keyring.pgp` to take care of the problem.

- It was time to download the repository.
  - <img width="1116" alt="Screenshot 2025-04-01 at 0 01 37" src="https://github.com/user-attachments/assets/17d67506-405f-483b-965a-b125e8e6702e" />
  
- After a successful installation I updated the metadata with `$ sudo apt update`
  - <img width="1272" alt="Screenshot 2025-04-01 at 0 10 06" src="https://github.com/user-attachments/assets/5226d6a7-998e-4dee-b5bb-334062d979c9" />

- Now I could just simply download the salt-minion with: `sudo apt install salt-minion`
  - <img width="1268" alt="Screenshot 2025-04-01 at 0 28 29" src="https://github.com/user-attachments/assets/842b641f-d9ae-41d5-a990-215c365bf3ad" />
<img width="1269" alt="Screenshot 2025-04-01 at 0 46 53" src="https://github.com/user-attachments/assets/6d30d498-23c7-4d62-9089-a6d82466c22f" />

<br>

# The crucial five (C)
> References: <https://terokarvinen.com/2021/salt-run-command-locally/>

### 1 - PKG
- Running the command `$ sudo salt-call --local -l info state.single pkg.installed tmux` will check if the package is installed (in this case tmux), and if not already present, install it.
  - <img width="1271" alt="Screenshot 2025-04-01 at 0 40 08" src="https://github.com/user-attachments/assets/669f5e4a-4637-441e-8292-0ecfad983c70" />
  - The line "Comment: All specified packages are already installed" indeed confirms that tmux is already installed

### 2 - File
- The `$ sudo salt-call --local -l info state.single file.managed` + `filepath` will check if the specified file exist. If not, it will create the file. If you specify with the command + `contents="xyz"`, if will check for the file and contents. If the file exists, but the content doesn't match, it will overwrite the file.
- <img width="1270" alt="Screenshot 2025-04-01 at 1 24 08" src="https://github.com/user-attachments/assets/14f6fe8f-46ca-4011-8cc5-486e85f82622" />
- <img width="1268" alt="Screenshot 2025-04-01 at 1 24 23" src="https://github.com/user-attachments/assets/45d13b7e-5adf-4a8d-8baa-73396f29134c" />








<br>
<br>

### References:
<br> 

- <https://terokarvinen.com/palvelinten-hallinta/#laksyt>
- <https://terokarvinen.com/2021/salt-run-command-locally/>
- <https://terokarvinen.com/2018/03/28/salt-quickstart-salt-stack-master-and-slave-on-ubuntu-linux/>
